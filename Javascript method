import org.springframework.stereotype.Component;
import java.util.*;

@Component
public class TableConverter {
    public List<Section> convertToStructuredObjects(List<List<String>> records) {
        Map<String, Section> sectionMap = new LinkedHashMap<>();

        for (List<String> record : records) {
            String sectionName = record.get(0);
            String subsectionName = record.get(1);
            String questionSubsectionName = record.get(2);
            String question = record.get(3);
            String options = record.get(4); // This should be a comma-separated list
            String answer = record.get(5);

            List<String> optionsList = new ArrayList<>();
            if (options != null && !options.isEmpty()) {
                optionsList = Arrays.asList(options.split(","));
            }

            Section section = sectionMap.computeIfAbsent(sectionName, Section::new);
            Subsection subsection = section.getOrCreateSubsection(subsectionName);
            QuestionSubsection questionSubsection = subsection.getOrCreateQuestionSubsection(questionSubsectionName);
            TableEntry tableEntry = new TableEntry(question, answer, questionSubsection);

            for (String option : optionsList) {
                OptionChoice optionChoice = new OptionChoice(option, tableEntry);
                tableEntry.addOptionChoice(optionChoice);
            }
        }

        return new ArrayList<>(sectionMap.values());
    }
}
